



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.2">
    
    
      
        <title>Components - Convex's Blog</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#components" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Convex's Blog" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Convex's Blog
            </span>
            <span class="md-header-nav__topic">
              Components
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Convex's Blog" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Convex's Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Openstack
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Openstack
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Networking (neutron) concepts/" title="Networking (neutron) concepts" class="md-nav__link">
      Networking (neutron) concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Openstack Keystone/" title="Openstack Keystone" class="md-nav__link">
      Openstack Keystone
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Identity service overview/" title="Identity service overview" class="md-nav__link">
      Identity service overview
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../about/" title="About" class="md-nav__link">
      About
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#components" title="Components" class="md-nav__link">
    Components
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proxy-servers" title="Proxy servers¶" class="md-nav__link">
    Proxy servers¶
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rings" title="Rings¶" class="md-nav__link">
    Rings¶
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zones" title="Zones¶" class="md-nav__link">
    Zones¶
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accounts-and-containers" title="Accounts and containers¶" class="md-nav__link">
    Accounts and containers¶
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#partitions" title="Partitions¶" class="md-nav__link">
    Partitions¶
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#replicators" title="Replicators¶" class="md-nav__link">
    Replicators¶
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-cases" title="Use cases¶" class="md-nav__link">
    Use cases¶
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#upload" title="Upload¶" class="md-nav__link">
    Upload¶
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#download" title="Download¶" class="md-nav__link">
    Download¶
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Components</h1>
                
                <h2 id="components">Components</h2>
<p>Object Storage uses the following components to deliver high availability, high durability, and high concurrency:</p>
<ul>
<li><strong>Proxy servers</strong> - Handle all of the incoming API requests.</li>
<li><strong>Rings</strong> - Map logical names of data to locations on particular disks.</li>
<li><strong>Zones</strong> - Isolate data from other zones. A failure in one zone does not impact the rest of the cluster as data replicates across zones.</li>
<li><strong>Accounts and containers</strong> - Each account and container are individual databases that are distributed across the cluster. An account database contains the list of containers in that account. A container database contains the list of objects in that container.</li>
<li><strong>Objects</strong> - The data itself.</li>
<li><strong>Partitions</strong> - A partition stores objects, account databases, and container databases and helps manage locations where data lives in the cluster.</li>
</ul>
<p><strong>Object Storage building blocks</strong></p>
<p><img alt="../_images/objectstorage-buildingblocks.png" src="https://docs.openstack.org/swift/pike/_images/objectstorage-buildingblocks.png" /></p>
<h2 id="proxy-servers">Proxy servers<a href="https://docs.openstack.org/swift/pike/admin/objectstorage-components.html#proxy-servers">¶</a></h2>
<p>Proxy servers are the public face of Object Storage and handle all of the incoming API requests. Once a proxy server receives a request, it determines the storage node based on the object’s URL, for example: <code>https://swift.example.com/v1/account/container/object</code>. Proxy servers also coordinate responses, handle failures, and coordinate timestamps.</p>
<p>Proxy servers use a shared-nothing architecture and can be scaled as needed based on projected workloads. A minimum of two proxy servers should be deployed behind a separately-managed load balancer. If one proxy server fails, the others take over.</p>
<h2 id="rings">Rings<a href="https://docs.openstack.org/swift/pike/admin/objectstorage-components.html#rings">¶</a></h2>
<p>A ring represents a mapping between the names of entities stored in the cluster and their physical locations on disks. There are separate rings for accounts, containers, and objects. When components of the system need to perform an operation on an object, container, or account, they need to interact with the corresponding ring to determine the appropriate location in the cluster.</p>
<p>The ring maintains this mapping using zones, devices, partitions, and replicas. Each partition in the ring is replicated, by default, three times across the cluster, and partition locations are stored in the mapping maintained by the ring. The ring is also responsible for determining which devices are used as handoffs in failure scenarios.</p>
<p>Data can be isolated into zones in the ring. Each partition replica will try to reside in a different zone. A zone could represent a drive, a server, a cabinet, a switch, or even a data center.</p>
<p>The partitions of the ring are distributed among all of the devices in the Object Storage installation. When partitions need to be moved around (for example, if a device is added to the cluster), the ring ensures that a minimum number of partitions are moved at a time, and only one replica of a partition is moved at a time.</p>
<p>You can use weights to balance the distribution of partitions on drives across the cluster. This can be useful, for example, when differently sized drives are used in a cluster.</p>
<p>The ring is used by the proxy server and several background processes (like replication).</p>
<p><strong>The ring</strong></p>
<p><img alt="../_images/objectstorage-ring.png" src="https://docs.openstack.org/swift/pike/_images/objectstorage-ring.png" /></p>
<p>These rings are externally managed. The server processes themselves do not modify the rings, they are instead given new rings modified by other tools.</p>
<p>The ring uses a configurable number of bits from an <code>MD5</code> hash for a path as a partition index that designates a device. The number of bits kept from the hash is known as the partition power, and 2 to the partition power indicates the partition count. Partitioning the full <code>MD5</code> hash ring allows other parts of the cluster to work in batches of items at once which ends up either more efficient or at least less complex than working with each item separately or the entire cluster all at once.</p>
<p>Another configurable value is the replica count, which indicates how many of the partition-device assignments make up a single ring. For a given partition index, each replica’s device will not be in the same zone as any other replica’s device. Zones can be used to group devices based on physical locations, power separations, network separations, or any other attribute that would improve the availability of multiple replicas at the same time.</p>
<h2 id="zones">Zones<a href="https://docs.openstack.org/swift/pike/admin/objectstorage-components.html#zones">¶</a></h2>
<p>Object Storage allows configuring zones in order to isolate failure boundaries. If possible, each data replica resides in a separate zone. At the smallest level, a zone could be a single drive or a grouping of a few drives. If there were five object storage servers, then each server would represent its own zone. Larger deployments would have an entire rack (or multiple racks) of object servers, each representing a zone. The goal of zones is to allow the cluster to tolerate significant outages of storage servers without losing all replicas of the data.</p>
<p><strong>Zones</strong></p>
<p><img alt="../_images/objectstorage-zones.png" src="https://docs.openstack.org/swift/pike/_images/objectstorage-zones.png" /></p>
<h2 id="accounts-and-containers">Accounts and containers<a href="https://docs.openstack.org/swift/pike/admin/objectstorage-components.html#accounts-and-containers">¶</a></h2>
<p>Each account and container is an individual SQLite database that is distributed across the cluster. An account database contains the list of containers in that account. A container database contains the list of objects in that container.</p>
<p><strong>Accounts and containers</strong></p>
<p><img alt="../_images/objectstorage-accountscontainers.png" src="https://docs.openstack.org/swift/pike/_images/objectstorage-accountscontainers.png" /></p>
<p>To keep track of object data locations, each account in the system has a database that references all of its containers, and each container database references each object.</p>
<h2 id="partitions">Partitions<a href="https://docs.openstack.org/swift/pike/admin/objectstorage-components.html#partitions">¶</a></h2>
<p>A partition is a collection of stored data. This includes account databases, container databases, and objects. Partitions are core to the replication system.</p>
<p>Think of a partition as a bin moving throughout a fulfillment center warehouse. Individual orders get thrown into the bin. The system treats that bin as a cohesive entity as it moves throughout the system. A bin is easier to deal with than many little things. It makes for fewer moving parts throughout the system.</p>
<p>System replicators and object uploads/downloads operate on partitions. As the system scales up, its behavior continues to be predictable because the number of partitions is a fixed number.</p>
<p>Implementing a partition is conceptually simple: a partition is just a directory sitting on a disk with a corresponding hash table of what it contains.</p>
<p><strong>Partitions</strong></p>
<p><img alt="../_images/objectstorage-partitions.png" src="https://docs.openstack.org/swift/pike/_images/objectstorage-partitions.png" /></p>
<h2 id="replicators">Replicators<a href="https://docs.openstack.org/swift/pike/admin/objectstorage-components.html#replicators">¶</a></h2>
<p>In order to ensure that there are three copies of the data everywhere, replicators continuously examine each partition. For each local partition, the replicator compares it against the replicated copies in the other zones to see if there are any differences.</p>
<p>The replicator knows if replication needs to take place by examining hashes. A hash file is created for each partition, which contains hashes of each directory in the partition. For a given partition, the hash files for each of the partition’s copies are compared. If the hashes are different, then it is time to replicate, and the directory that needs to be replicated is copied over.</p>
<p>This is where partitions come in handy. With fewer things in the system, larger chunks of data are transferred around (rather than lots of little TCP connections, which is inefficient) and there is a consistent number of hashes to compare.</p>
<p>The cluster has an eventually-consistent behavior where old data may be served from partitions that missed updates, but replication will cause all partitions to converge toward the newest data.</p>
<p><strong>Replication</strong></p>
<p><img alt="../_images/objectstorage-replication.png" src="https://docs.openstack.org/swift/pike/_images/objectstorage-replication.png" /></p>
<p>If a zone goes down, one of the nodes containing a replica notices and proactively copies data to a handoff location.</p>
<h2 id="use-cases">Use cases<a href="https://docs.openstack.org/swift/pike/admin/objectstorage-components.html#use-cases">¶</a></h2>
<p>The following sections show use cases for object uploads and downloads and introduce the components.</p>
<h3 id="upload">Upload<a href="https://docs.openstack.org/swift/pike/admin/objectstorage-components.html#upload">¶</a></h3>
<p>A client uses the REST API to make a HTTP request to PUT an object into an existing container. The cluster receives the request. First, the system must figure out where the data is going to go. To do this, the account name, container name, and object name are all used to determine the partition where this object should live.</p>
<p>Then a lookup in the ring figures out which storage nodes contain the partitions in question.</p>
<p>The data is then sent to each storage node where it is placed in the appropriate partition. At least two of the three writes must be successful before the client is notified that the upload was successful.</p>
<p>Next, the container database is updated asynchronously to reflect that there is a new object in it.</p>
<p><strong>Object Storage in use</strong></p>
<p><img alt="../_images/objectstorage-usecase.png" src="https://docs.openstack.org/swift/pike/_images/objectstorage-usecase.png" /></p>
<h3 id="download">Download<a href="https://docs.openstack.org/swift/pike/admin/objectstorage-components.html#download">¶</a></h3>
<p>A request comes in for an account/container/object. Using the same consistent hashing, the partition index is determined. A lookup in the ring reveals which storage nodes contain that partition. A request is made to one of the storage nodes to fetch the object and, if that fails, requests are made to the other nodes.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.d9aa80ab.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>